@page "/{userId}/Class/{classId}"
@using SmartStudy.Components.Shared
@using SmartStudy.Models
@using SmartStudy.Services

@if (!string.IsNullOrWhiteSpace(ClassId))
{
    <div class="class-page-header text-center">
        <h1 class="class-title">@(CurrentClass?.Name ?? ClassId)</h1>
    </div>
}
else
{
    <p>No class selected.</p>
}

@if (isStudent)
{
	<div class="mt-3">
		<h3 class="text-center">Assignments</h3>
		<!-- Temporary hardcoded assignment list items -->
        @if (AssignmentList.Count == 0)
        {
            <p class="text-center text-muted">No assignments available.</p>
        }
        @foreach(var assignment in AssignmentList)
        {
            <div class="d-flex flex-column align-items-center">
                <AssignmentListItem AssignmentName="@assignment.Title" GradedFileName="@assignment.FileName"
                    DetailPageUrl="@($"/{UserId}/Class/{ClassId}/assignment/{assignment.Id}")" />
            </div>
        }
	</div>
}
else
{
    <h3 class="section-heading text-center mt-4">Students</h3>

    @if (StudentsInClass is not null && StudentsInClass.Count > 0)
    {
        <div class="d-flex flex-wrap justify-content-center gap-3 mb-4 mt-3">
            @foreach (var s in StudentsInClass)
            {
                ProfileDTO? profile = ProfileService.GetProfile(s.Id);
                var initials = (s.DisplayName ?? s.Username ?? "U")[0].ToString().ToUpperInvariant();
                var profileUrl = $"/{UserId}/Class/{ClassId}/Student/{s.Id}";

                <div class="user-profile-card">
                    <div class="profile-header">
                        <img src="@GetProfileImageUrl(s)" alt="Profile Picture" class="profile-image" loading="lazy" onerror="this.onerror=null;this.src='/profile_pictures/default-profile-account-unknown-icon-black-silhouette-free-vector.jpg';">
                        <h3 class="user-name">@(s.DisplayName ?? s.Username ?? "Unknown")</h3>
                        <p class="user-title">Student</p>
                    </div>
                    <div class="profile-actions">
                        <button class="action-button-main" @onclick="(() => ShowUploadModalForStudent(s))">
                            Upload File
                        </button>
                        <button class="action-button-secondary" @onclick="(() => OpenProfileModalForStudent(profile))" title="View Profile">
                            <i class="bi bi-person icon" aria-label="Profile"></i>
                        </button>
                        <button class="action-button-secondary" @onclick="(() => OpenAssignmentsPageForStudent(s))" title="Go to Assignment">
                            <i class="bi bi-journal-text icon" aria-label="Assignment"></i>
                        </button>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <p class="text-center text-muted">No students enrolled yet.</p>
    }
}

<ProfileModal @ref="profileModalRef" EnableEditButton="false" />

@* Shared upload modal instance; we set its parameters dynamically before opening *@
<UploadAssignmentModal @ref="uploadModalRef"
                      TargetUserId="@UploadTargetUserId"
                      ClassId="@ClassId"
                      StudentName="@UploadStudentName"
                      ProfileImageUrl="@UploadProfileImageUrl"
                      TeacherId="@UserId"
                      OnUploaded="@OnAssignmentUploaded" />

<style>
    .class-page-header {
        padding-top: 1.25rem;   /* was 1.75 */
        padding-bottom: 0;      /* was 0.75 — removed space below */
        text-align: center;
    }

    .class-title {
        font-size: 2.35rem;
        font-weight: 600;
        color: #2C3E50;
        margin: 0 auto;
        padding-bottom: 0.25rem; /* was 0.4 — reduced */
        border-bottom: 2px solid #dcdcdc;
        display: inline-block;
        letter-spacing: 0.4px;
    }

    .section-heading {
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 1.75rem;
        letter-spacing: 0.3px;
    }
</style>

